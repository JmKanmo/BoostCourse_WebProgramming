package Todo;

import java.sql.DriverManager;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.List;

import com.mysql.jdbc.Connection;
import com.mysql.jdbc.PreparedStatement;

public class TodoDao {
	private String password = "connect123!@#";
	private String user = "connectuser";
	private String url = "jdbc:mysql://localhost:3306/connectDB";

	public int addTodo(TodoDto todo) {
		return 0;
	}

	public List<TodoDto> getTodos() {
		List<TodoDto> list = new ArrayList<>();

		try {
			Class.forName("com.mysql.jdbc.Driver");
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		}

		try (Connection conn = (Connection) DriverManager.getConnection(url, user, password);
				PreparedStatement ps = (PreparedStatement) conn.prepareStatement("select* from todo");) {

			try (ResultSet rs = ps.executeQuery()) {
				while (rs.next()) {
					list.add(new TodoDto(rs.getLong(1), rs.getString(2), rs.getString(3), rs.getInt(4), rs.getString(5),
							rs.getString(6).split(" ")[0]));
				}
			} catch (Exception e) {
				e.printStackTrace();
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		return list;
	}

	public boolean updateTodo(TodoDto param) {
		boolean ret = true;
		Long id = param.getId();
		String type = param.getType();

		try {
			Class.forName("com.mysql.jdbc.Driver");
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		}

		try (Connection conn = (Connection) DriverManager.getConnection(url, user, password);
				PreparedStatement ps = (PreparedStatement) conn
						.prepareStatement("update todo set type = ? where id = ?");) {
			if (type.equals("TODO")) {
				type = "DOING";
			} else if (type.equals("DOING")) {
				type = "DONE";
			}
			ps.setString(1, type);
			ps.setLong(2, id);
			ps.executeUpdate();
		} catch (Exception e) {
			e.printStackTrace();
			ret = false;
		}
		return ret;
	}
}
